#!/bin/bash

# Make sure you do the following:
#
# /etc/systemd/system/xclip.service 
# [Unit]
# Description=Service for xclip listener
# Wants=network.target
# After=network.target
# 
# [Service]
# EnvironmentFile=-/etc/environment
# ExecStart=/usr/bin/ncat -k -l localhost 19988 -c "/usr/bin/xclip -d :0 -selection clipboard"
# Restart=always
# Type=simple
# User=abe
# Group=abe
# 
# [Install]
# WantedBy=multi-user.target
#
# ~/.ssh/config 
# Host hostname
#   HostName hostname
#   RemoteForward 19988 localhost:19988
#
# $ systemctl enable xclip

if [ ! -x /usr/bin/kpcli ]
then
  echo "Install dependencies"
  sudo apt-get install kpcli libterm-readline-gnu-perl libdata-password-perl
fi

read -p "Find: " f
echo -n "Password:"
kpcli --kdb=abe.kdbx --command="show -f /Root/Servers/$f" | awk '/Pass:/{print $2}' | tmux-yank

tmux new-window -d 'sleep 10; echo -n "" | tmux-yank 2>&1 > /dev/null'
