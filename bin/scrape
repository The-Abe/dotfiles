#!/usr/bin/env ruby
# frozen-string-literal: true

require 'bundler/inline'
gemfile do
  gem 'nokogiri'
end

require 'open-uri'
require 'nokogiri'

if ARGV[0].nil? || ARGV[1].nil?
  warn 'Usage: scrape url css-selector <output attribute>'
  exit 1
end

elements = Nokogiri::HTML.parse(URI.open(ARGV[0]).read).css(ARGV[1])
if ARGV[2].nil?
  elements.each do |element|
    puts element.text
  end
else
  elements.each do |element|
    output = []
    ARGV[2..].each do |attribute|
      output << (attribute == 'text' ? element.text : element.attribute(attribute))
    end
    puts output.join(', ')
  end
end
